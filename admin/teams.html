<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assassins</title>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <script src="/src/site.js"></script>
    <script src="/dist/bundle.js"></script>
    <script src="/dist/bundleTeams.js"></script>
    <script src="/dist/bundleAdmin.js"></script>
    <script src="/dist/bundleHistory.js"></script>
    <script src="/dist/words.js"></script>

    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  </head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H5Z5SD6V6S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-H5Z5SD6V6S');
</script>

  <body>
    <nav
      class="navbar navbar-dark sticky-top navbar-expand-lg bg-body-tertiary"
    >
      <div class="container-fluid">
        <a class="navbar-brand">Higley</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-link" href="home.html">Home</a>
            <a class="nav-link active" href="teams.html">Teams</a>
            <a class="nav-link" href="players.html">Players</a>
            <a class="nav-link" href="targets.html">Targets</a>
            <a class="nav-link" href="messages.html">Messages
              <span
              id="notification"
              class="top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle notification"
              style="display:none"
            >
            </a>
            <a class="nav-link" href="rules.html">Rules</a>
            <button
              type="button"
              id="logout"
              onclick="logout()"
              class="btn btn-primary me-auto loginButton"
              data-bs-toggle="modal"
              data-bs-target="#loginModal"
            >
              Log Out
            </button>
          </div>
        </div>
      </div>
    </nav>

    <div class="container-fluid text-center" id="container">
      <div class="row align-items-start" id="row">
        <div class="col col-2" id="left"></div>
        <div class="col">
          <div class="container text-center">
            <div class="row align-items-start">
              <div class="col" id="col1">
                <button
                  type="button"
                  class="btn btn-outline-primary teamButton"
                  data-bs-toggle="modal"
                  data-bs-target="#addModal"
                >
                  Add Team
                </button>
                <div
                  class="modal fade"
                  id="addModal"
                  tabindex="-1"
                  aria-labelledby="exampleModalLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">
                          Add Team Form
                        </h1>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                          onclick="clearAddForm()"
                        ></button>
                      </div>
                      <div class="modal-body" id="addBody">
                        <div class="input-group mb-3">
                          <span class="input-group-text">Team Name</span>
                          <div class="input-group-text">
                            <input
                              id="addCheck"
                              class="form-check-input mt-0"
                              type="checkbox"
                              checked
                              value=""
                              aria-label="Checkbox for following text input"
                              data-bs-toggle="tooltip"
                              data-bs-placement="top"
                              data-bs-title="Is this team currently alive"
                            />
                          </div>
                          <div class="input-group-text">
                            <input
                              id="addCheck2"
                              class="form-check-input mt-0"
                              type="checkbox"
                              checked
                              value=""
                              aria-label="Checkbox for following text input"
                              data-bs-toggle="tooltip"
                              data-bs-placement="top"
                              data-bs-title="Is this team currently safe"
                            />
                          </div>
                          <input
                            id="addName"
                            type="text"
                            class="form-control"
                            placeholder="Team Name"
                            aria-label="Username"
                            aria-describedby="basic-addon1"
                          />
                        </div>
                        <div class="input-group mb-3">
                          <span class="input-group-text">Team Password</span>
                          <div
                            class="input-group-text"
                            onclick="findWord(addPassword)"
                            data-bs-toggle="tooltip"
                            data-bs-placement="top"
                            data-bs-title="Randomize Password"
                          >
                            <i class="bi bi-arrow-repeat"></i>
                          </div>
                          <input
                            id="addPassword"
                            type="text"
                            class="form-control"
                            placeholder="Password"
                            aria-label="Username"
                            aria-describedby="basic-addon1"
                          />
                        </div>
                        <div class="input-group mb-3">
                          <span class="input-group-text">Player 1</span>
                          <div class="input-group-text">
                            <input
                              id="newP1"
                              class="form-check-input mt-0"
                              type="checkbox"
                              value=""
                              checked
                              aria-label="Checkbox for following text input"
                              data-bs-toggle="tooltip"
                              data-bs-placement="top"
                              data-bs-title="Is this player currently alive"
                            />
                          </div>
                          <input
                            id="addPlayer1"
                            type="text"
                            class="form-control"
                            placeholder="Name"
                            aria-label="Username"
                            aria-describedby="basic-addon1"
                          />
                        </div>
                        <div class="input-group mb-3">
                          <span class="input-group-text">Player 2</span>
                          <div class="input-group-text">
                            <input
                              id="newP2"
                              class="form-check-input mt-0"
                              type="checkbox"
                              value=""
                              checked
                              aria-label="Checkbox for following text input"
                              data-bs-toggle="tooltip"
                              data-bs-placement="top"
                              data-bs-title="Is this player currently alive"
                            />
                          </div>
                          <input
                            type="text"
                            id="addPlayer2"
                            class="form-control"
                            placeholder="Name"
                            aria-label="Username"
                            aria-describedby="basic-addon1"
                          />
                        </div>
                        <div class="input-group mb-3">
                          <span class="input-group-text">Player 3</span>
                          <div class="input-group-text">
                            <input
                              id="newP3"
                              class="form-check-input mt-0"
                              type="checkbox"
                              value=""
                              checked
                              aria-label="Checkbox for following text input"
                              data-bs-toggle="tooltip"
                              data-bs-placement="top"
                              data-bs-title="Is this player currently alive"
                            />
                          </div>
                          <input
                            id="addPlayer3"
                            type="text"
                            class="form-control"
                            placeholder="Name"
                            aria-label="Username"
                            aria-describedby="basic-addon1"
                          />
                        </div>
                        <div class="input-group mb-3">
                          <span class="input-group-text">Player 4</span>
                          <div class="input-group-text">
                            <input
                              id="newP4"
                              class="form-check-input mt-0"
                              type="checkbox"
                              value=""
                              checked
                              aria-label="Checkbox for following text input"
                              data-bs-toggle="tooltip"
                              data-bs-placement="top"
                              data-bs-title="Is this player currently alive"
                            />
                          </div>
                          <input
                            id="addPlayer4"
                            type="text"
                            class="form-control"
                            placeholder="Name (optional)"
                            aria-label="Username"
                            aria-describedby="basic-addon1"
                          />
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                          onclick="clearAddForm()"
                        >
                          Close
                        </button>
                        <button
                          type="button"
                          onclick="addTeam()"
                          class="btn btn-primary"
                        >
                          Save changes
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col" id="col2">
                <button
                  type="button"
                  class="btn btn-outline-primary teamButton"
                  data-bs-toggle="modal"
                  data-bs-target="#deleteModal"
                  onclick="upDelete()"
                >
                  Delete Team
                </button>
                <div
                  id="deleteModal"
                  class="modal fade"
                  tabindex="-1"
                  aria-labelledby="exampleModalLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">
                          Delete Team Form
                        </h1>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body" id="deleteBody"></div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button
                          type="button"
                          onclick="deleteTeam()"
                          class="btn btn-primary"
                        >
                          Save changes
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col" id="col3">
                <button
                  type="button"
                  class="btn btn-outline-primary teamButton"
                  data-bs-toggle="modal"
                  data-bs-target="#assignTeams"
                  disabled
                >
                  Auto Assign Teams
                </button>
                <div
                  class="modal fade"
                  id="assignTeams"
                  tabindex="-1"
                  aria-labelledby="exampleModalLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">
                          Auto Assign Teams
                        </h1>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div id="randomBody" class="modal-body">
                        <button
                          id="randButton"
                          type="button"
                          onclick="generateTeams()"
                          class="btn btn-primary"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="16"
                            height="16"
                            fill="currentColor"
                            class="bi bi-shuffle"
                            viewBox="0 0 16 16"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"
                            />
                            <path
                              d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"
                            />
                          </svg>
                          Randomize
                        </button>
                      </div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button
                          type="button"
                          onclick="saveTeams()"
                          class="btn btn-primary"
                        >
                          Save changes
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div aria-live="polite" aria-atomic="true" class="position-relative">
            <!-- Position it: -->
            <!-- - `.toast-container` for spacing between toasts -->
            <!-- - `top-0` & `end-0` to position the toasts in the upper right corner -->
            <!-- - `.p-3` to prevent the toasts from sticking to the edge of the container  -->
            <div class="toast-container">
              <!-- Then put toasts within -->
              <div
                class="toast align-items-center text-bg-success border-0"
                role="alert"
                aria-live="assertive"
                aria-atomic="true"
                id="liveToast"
              >
                <div class="d-flex">
                  <div class="toast-body" id="toastBody"></div>
                  <button
                    type="button"
                    class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"
                    aria-label="Close"
                  ></button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col col-2" id="right"></div>
      </div>
    </div>
  </body>
</html>

<script>
  window.makeToast = function (content) {
    const toastLiveExample = document.getElementById("liveToast");
    const toastBootstrap =
      bootstrap.Toast.getOrCreateInstance(toastLiveExample);
    toastBootstrap.show();
    var body = (document.getElementById("toastBody").innerHTML = content);
  };

  initPage();
  async function initPage() {
    var teams = await updateTeams;
    var names = await updateUsers;
    var currentColNum = 0;

    var addArea = document.getElementById("addBody");
    addArea.innerHTML += "Targets: <select id='addSelect'> </select>";
    var addSelect = document.getElementById("addSelect");
    addSelect.innerHTML += "<option value='null'>none</option>";

    for (let z = 0; z < teams.length; z++) {
      addSelect.innerHTML +=
        "<option value='" +
        teams[z].teamName +
        "'>" +
        teams[z].teamName +
        "</option>";
    }

    var deleteArea = document.getElementById("deleteBody");
    deleteArea.innerHTML += "Targets: <select id='deleteSelect'> </select>";
    var deleteSelect = document.getElementById("deleteSelect");

    for (let a = 0; a < teams.length; a++) {
      deleteSelect.innerHTML +=
        "<option value='" +
        teams[a].teamName +
        "'>" +
        teams[a].teamName +
        "</option>";
    }

    for (let i = 0; i < teams.length; i++) {
      if (currentColNum < 3) {
        currentColNum++;
      } else {
        var currentColNum = 1;
      }

      $(document).ready(function () {
        $("#" + teams[i].teamName.replace(/\s/g, "") + "Select").select2({
          dropdownParent: $("#" + teams[i].teamName.replace(/\s/g, "")),
        });
      });

      $(document).ready(function () {
        $("#addSelect").select2({
          dropdownParent: $("#addModal"),
        });
      });

      $(document).ready(function () {
        $("#deleteSelect").select2({
          dropdownParent: $("#deleteModal"),
        });
      });

      var currentCol = "col" + currentColNum;
      var col = document.getElementById(currentCol);
      var modalName = teams[i].teamName.replace(/\s/g, "");
      var check = ''
      if (teams[i].status == true) {
        check = 'checked'
      }
     
      col.innerHTML +=
        "<button type='button' id='input' class='btn btn-primary teamButton' data-bs-toggle='modal' data-bs-target='#" +
        modalName +
        "'>" +
        teams[i].teamName +
        "</button>";

      col.innerHTML +=
        "<div class='modal fade' id='" +
        modalName +
        "' aria-labelledby='exampleModalLabel' aria-hidden='true'> <div class='modal-dialog'> <div class='modal-content'> <div class='modal-header'>  <h1 class='modal-title fs-5' id='exampleModalLabel'>" +
        teams[i].teamName +
        " </h1> <input class='form-check-input mt-0 statBut' type='checkbox' id='teamStatus" +
        modalName +
        "' " + check + "><input class='form-check-input mt-0 statBut' type='checkbox' id='teamSafe" +
        modalName +
        "' " + check + "><button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button> </div> <div id='" +
        teams[i].teamName +
        "textArea' class='modal-body'></div> <div class='modal-footer'> <button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button> <button onclick='save(" +
        i +
        ")' type='button' class='btn btn-primary'>Save changes</button> </div> </div>  </div> </div>";
      var modalArea = document.getElementById(teams[i].teamName + "textArea");
      modalArea.innerHTML +=
        "<div class='input-group mb-3'> <span class='input-group-text' id='basic-addon1'>Player 1</span> <div class='input-group-text'> <input data-bs-toggle='tooltip' data-bs-placement='top' data-bs-title='Is this player currently alive' class='form-check-input mt-0' type='checkbox' id='" +
        teams[i].teamName +
        "Box1' aria-label='Checkbox for following text input'> </div> <input type='text' disabled class='form-control' aria-label='Username' aria-describedby='basic-addon1' id='" +
        teams[i].teamName +
        "-player1' value='" +
        teams[i].player1 +
        "'> </div>";
      modalArea.innerHTML +=
        "<div class='input-group mb-3'> <span class='input-group-text' id='basic-addon1'>Player 2</span> <div class='input-group-text'> <input data-bs-toggle='tooltip' data-bs-placement='top' data-bs-title='Is this player currently alive' class='form-check-input mt-0' type='checkbox' id='" +
        teams[i].teamName +
        "Box2'  aria-label='Checkbox for following text input'> </div> <input type='text' disabled class='form-control' aria-label='Username' aria-describedby='basic-addon1' id='" +
        teams[i].teamName +
        "-player2' value='" +
        teams[i].player2 +
        "'> </div>";
      modalArea.innerHTML +=
        "<div class='input-group mb-3'> <span class='input-group-text' id='basic-addon1'>Player 3</span> <div class='input-group-text'> <input data-bs-toggle='tooltip' data-bs-placement='top' data-bs-title='Is this player currently alive' class='form-check-input mt-0' type='checkbox' id='" +
        teams[i].teamName +
        "Box3'  aria-label='Checkbox for following text input'> </div> <input type='text' disabled class='form-control' aria-label='Username' aria-describedby='basic-addon1' id='" +
        teams[i].teamName +
        "-player3' value='" +
        teams[i].player3 +
        "'> </div>";
      if (teams[i].player4) {
        modalArea.innerHTML +=
          "<div class='input-group mb-3'> <span class='input-group-text' id='basic-addon1'>Player 4</span> <div class='input-group-text'> <input data-bs-toggle='tooltip' data-bs-placement='top' data-bs-title='Is this player currently alive' class='form-check-input mt-0' type='checkbox' id='" +
          teams[i].teamName +
          "Box4'  aria-label='Checkbox for following text input'> </div> <input type='text' disabled class='form-control' aria-label='Username' aria-describedby='basic-addon1' id='" +
          teams[i].teamName +
          "-player4' value='" +
          teams[i].player4 +
          "'> </div>";
      } else {
        modalArea.innerHTML +=
          "<div class='input-group mb-3'> <span class='input-group-text' id='basic-addon1'>Player 4</span> <div class='input-group-text'> <input class='form-check-input mt-0' type='checkbox' id='" +
          teams[i].teamName +
          "Box4'  aria-label='Checkbox for following text input'> </div> <input type='text' disabled class='form-control' aria-label='Username' aria-describedby='basic-addon1' id='" +
          teams[i].teamName +
          "-player4'> </div>";
      }
      modalArea.innerHTML +=
        "<div class='input-group mb-3'> <span class='input-group-text' id='basic-addon1'>Squad Wipes</span> <input type='text' class='form-control' aria-describedby='basic-addon1' id='" +
        teams[i].teamName +
        "squad' value='" +
        teams[i].squad +
        "'> </div>";

      modalArea.innerHTML +=
        "<div class='input-group mb-3'> <span class='input-group-text' id='basic-addon1'>Password</span> <input type='text' class='form-control' aria-label='Username' aria-describedby='basic-addon1' id='" +
        teams[i].teamName +
        "Password' value='" +
        teams[i].teamPass +
        "'> </div>";

      modalArea.innerHTML +=
        "Targets: <select id='" +
        teams[i].teamName.replace(/\s/g, "") +
        "Select'> </select>";
      var currentSelect = document.getElementById(
        teams[i].teamName.replace(/\s/g, "") + "Select"
      );
      for (let y = 0; y < teams.length; y++) {
        if (teams[i].teamName != teams[y].teamName) {
          if (teams[i].targets != teams[y].teamName) {
            currentSelect.innerHTML +=
              "<option value='" +
              teams[y].teamName +
              "'>" +
              teams[y].teamName +
              "</option>";
          } else if (teams[i].targets == teams[y].teamName) {
            currentSelect.innerHTML +=
              "<option value='" +
              teams[y].teamName +
              "' selected>" +
              teams[y].teamName +
              "</option>";
          }
        }
      }
      var user1 = teams[i].player1;
      var user2 = teams[i].player2;
      var user3 = teams[i].player3;
      for (let x = 0; x < names.length; x++) {
        if (names[x].name == user1) {
          if (names[x].status) {
            var ele = document.getElementById(teams[i].teamName + "Box1");
            ele.setAttribute("checked", "true");
          }
        }
      }
      for (let x = 0; x < names.length; x++) {
        if (names[x].name == user2) {
          if (names[x].status) {
            var ele = document.getElementById(teams[i].teamName + "Box2");
            ele.setAttribute("checked", "true");
          }
        }
      }
      for (let x = 0; x < names.length; x++) {
        if (names[x].name == user3) {
          if (names[x].status) {
            var ele = document.getElementById(teams[i].teamName + "Box3");
            ele.setAttribute("checked", "true");
          }
        }
      }
      if (teams[i].player4) {
        var user4 = teams[i].player4;
        for (let x = 0; x < names.length; x++) {
          if (names[x].name == user4) {
            if (names[x].status) {
              var ele = document.getElementById(teams[i].teamName + "Box4");
              ele.setAttribute("checked", "true");
            }
          }
        }
      }
    }
  }
  function addTeam() {
    var name = document.getElementById("addName").value.toLowerCase();
    var checked = document.getElementById("addCheck").checked;
    var safe = document.getElementById("addCheck2").checked;
    var password = document.getElementById("addPassword").value;
    var player1 = document.getElementById("addPlayer1").value.toLowerCase();
    var checked1 = document.getElementById("newP1").checked;
    var player2 = document.getElementById("addPlayer2").value.toLowerCase();
    var checked2 = document.getElementById("newP2").checked;
    var player3 = document.getElementById("addPlayer3").value.toLowerCase();
    var checked3 = document.getElementById("newP3").checked;
    var testVal = document.getElementById("addPlayer4").value;
    if (testVal) {
      var player4 = document.getElementById("addPlayer4").value.toLowerCase();
      var checked4 = document.getElementById("newP4").checked;
    } else {
      var player4 = false;
    }
    var target = (document.getElementById(
      "select2-addSelect-container"
    ).innerHTML = "");
    var teamExists = false;
    for (let c = 0; c < teams.length; c++) {
      if (name == teams[c].teamName) {
        var teamExists = true;
      }
    }
    if (teamExists) {
      alert("Team Name Already Exists");
    } else if (player1 == "" || player2 == "" || player3 == "") {
      alert("Fill player name 1-3 (player 4 optional)");
    } else if (password.includes(" ") || password == "") {
      alert("Password is empty or contains spaces");
    } else if (
      player1 == player2 ||
      player1 == player3 ||
      player1 == player4 ||
      player2 == player3 ||
      player2 == player4 ||
      player3 == player4
    ) {
      alert("Two or more team members names are the same");
    } else {
      writeNewTeam(
        name,
        password,
        player1,
        player2,
        player3,
        player4,
        target,
        checked,
        safe
      );
      writeNewUsers(
        name,
        password,
        player1,
        player2,
        player3,
        player4,
        checked,
        checked1,
        checked2,
        checked3,
        checked4
      );
    }
  }

  function upDelete() {}

  function deleteTeam() {
    var input = document.getElementById("deleteSelect").value;
    for (let b = 0; b < teams.length; b++) {
      if (teams[b].teamName == input) {
        var del1 = teams[b].player1;
        var del2 = teams[b].player2;
        var del3 = teams[b].player3;
        if (teams[b].player4) {
          var del4 = teams[b].player4;
        } else {
          var del4 = false;
        }
      }
    }
    deleteCurrent(input);
    deleteUsers(del1, del2, del3, del4);
  }

  // async function generateTeams() {
  //   let history = await updateHistory;
  //   let teams = await updateTeams;
  //   let read = await updateTeams;

  //   window.randomTeams = [];
  //   let errors = 0;

  //   while (teams.length != 0) {
  //     let numb = genInt();
  //     let team = getValidTeam(numb);
  //     randomTeams.push(team);
  //     let a = 0;
  //     let found = false;
  //     while (a < teams.length && found == false) {
  //       if (teams[a].teamName == team) {
  //         var teamNumber = teams.indexOf(teams[a]);
  //         found = true;
  //       }
  //       a++;
  //     }
  //     teams.splice(teamNumber, 1);
  //   }
  //   if (teams.length == 0) {
  //     let modalBody = document.getElementById("randomBody");

  //     while (modalBody.childElementCount > 1) {
  //       modalBody.lastElementChild.remove();
  //     }
  //     modalBody.innerHTML += "<div id=rep></div>";

  //     for (let b = 0; b < randomTeams.length; b++) {
  //       modalBody.innerHTML +=
  //         '<br> <span class="badge text-bg-secondary">' + randomTeams[b];
  //       let c = b - 1;
  //       if (c == -1) {
  //         c = randomTeams.length - 1;
  //       }
  //       if (checkHistory(randomTeams[c], randomTeams[b])) {
  //         modalBody.innerHTML +=
  //           '</span> <br> <i style="color: red" class="bi bi-caret-down-fill"></i>';
  //         errors++;
  //       } else {
  //         modalBody.innerHTML +=
  //           '</span> <br> <i class="bi bi-caret-down-fill"></i>';
  //       }
  //     }
  //     modalBody.lastElementChild.remove();
  //     let replacement = document.getElementById("rep");
  //     if (errors > 0) {
  //       replacement.innerHTML +=
  //         '<h3><span class="badge bg-warning"><i class="bi bi-exclamation-triangle"></i> There are ' +
  //         errors +
  //         ' teams with repeat targets <i class="bi bi-exclamation-triangle"></i></span></h3>';
  //     }
  //   } else {
  //     alert("sorry, there was an error");
  //   }

  //   function getValidTeam(numb) {
  //     let team = teams[numb].teamName;
  //     let length = randomTeams.length;
  //     if (length == 0) {
  //       //if there are no random teams yet (first one only)
  //       return team;
  //     }
  //     let length2 = length - 1;
  //     let pers = randomTeams[length2]; //this tells us who the new teams pers would be

  //     if (checkHistory(pers, team)) {
  //       //if they have history
  //       for (let a = 0; a < teams.length; a++) {
  //         //find a new team
  //         let team2 = teams[a].teamName;
  //         let x = a + 1;
  //         if (team == team2 && x != teams.length) {
  //           a++;
  //           let team2 = teams[a].teamName;
  //         }
  //         if (checkHistory(pers, team2)) {
  //           //if the new target does have history
  //           for (let b = 0; b < teams.length; b++) {
  //             //look for new pers
  //             let pers2 = teams[b].teamName;
  //             if (checkHistory(pers2, team)) {
  //               //if they also have history switch out persuer
  //               let removedPers = randomTeams.pop();
  //               for (let c = 0; c < read.length; c++) {
  //                 //get object > string
  //                 if (read[c].teamName == removedPers) {
  //                   teams.push(read[c]);
  //                 }
  //               }
  //               teams.push(remover);
  //               randomTeams.push(pers2);
  //               return team;
  //             } else {
  //               //else give up
  //               return team;
  //             }
  //           }
  //         } else {
  //           return team2;
  //         }
  //       }
  //       //if there are no remaining targets that work
  //     } else {
  //       return team;
  //     }
  //   }

  //   function checkHistory(a, b) {
  //     //a = pers   b = target
  //     for (let c = 0; c < history.length; c++) {
  //       let past = eval("history[c]." + a + ";");
  //       if (past == b) {
  //         return true;
  //       }
  //       return false;
  //     }
  //   }

  //   function genInt() {
  //     let size = teams.length;
  //     let number = Math.floor(Math.random() * size);
  //     return number;
  //   }
  // }

  // Function to generate a random order for teams
  function generateRandomOrder(teams) {
    const shuffledTeams = teams.slice();
    shuffleArray(shuffledTeams);
    return shuffledTeams;
  }

  // Function to shuffle an array using Fisher-Yates (Knuth) algorithm
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  // Function to generate a chasing order for teams, avoiding consecutive matches
  function generateChasingOrder(teams, previousChasingList) {
    let randomizedChasingOrder;
    do {
      randomizedChasingOrder = generateRandomOrder(teams);
    } while (
      randomizedChasingOrder.some(
        (team, index) => previousChasingList[0][index] === team
      )
    );

    return randomizedChasingOrder;
  }

  async function generateTeams() {
    var teams = await updateTeams;
    var history = await updateHistory;
    if (history[0]) {
      var previousChasingList = [];
      for (let a = 0; a < history.length; a++) {
        var current = [];
        var currentArray = Object.keys(history[a]);
        currentArray.pop();
        for (let b = 0; b < currentArray.length; b++) {
          if (b == 0) {
            var currentTeam = currentArray[0];
          }
          current.push(currentTeam);
          var currentTeam = history[a][currentTeam];
        }
        previousChasingList.push(current);
      }

      var teamNames = [];
      for (let c = 0; c < teams.length; c++) {
        teamNames.push(teams[c].teamName);
      }
      const randomizedChasingOrder = generateChasingOrder(
        teamNames,
        previousChasingList
      );

      updateTable(randomizedChasingOrder);
    } else {
      var teamNames = [];
      for (let d = 0; d < teams.length; d++) {
        teamNames.push(teams[d].id);
      }
      for (var i = teamNames.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = teamNames[i];
        teamNames[i] = teamNames[j];
        teamNames[j] = temp;
      }
      updateTable(teamNames);
    }
  }

  function updateTable(order) {
    var modalBody = document.getElementById("randomBody");
    while (modalBody.childElementCount > 1) {
      modalBody.removeChild(modalBody.lastChild);
    }
    if (modalBody.childElementCount == 1) {
      modalBody.innerHTML += "<div id=rep></div>";
    }
    for (let a = 0; a < order.length; a++) {
      modalBody.innerHTML +=
        '<br> <span class="badge text-bg-secondary teamBadge">' + order[a];
      modalBody.innerHTML +=
        '</span> <br> <i class="bi bi-caret-down-fill"></i>';
    }
    modalBody.removeChild(modalBody.lastChild);
  }

  initTargets();

  async function initTargets() {
    var history = await updateHistory;
    var modalBody = document.getElementById("randomBody");
    if (history[0]) {
      var admin = await updateAdmin;
      modalBody.innerHTML += "<div id=rep></div>";

      let length = history.length - 1;
      let currentWeek = history[length];
      let week = Object.values(currentWeek);
      let firstTeam = week[0];
      let order = [];
      let errors = 0;
      order.push(firstTeam);
      let xlength2 = order.length - 1;
      let xlast = order[xlength2];
      let xnewTeam = currentWeek[xlast];
      let xlength3 = order.xlength - 1;
      let xlast2 = order[xlength3];
      modalBody.innerHTML +=
        '<br> <span class="badge text-bg-secondary">' + order[0];
      if (checkInit(order[xlast], order[xlast2])) {
        modalBody.innerHTML +=
          '</span> <br> <i style="color: red" class="bi bi-caret-down-fill"></i>';
      } else {
        modalBody.innerHTML +=
          '</span> <br> <i class="bi bi-caret-down-fill"></i>';
      }

      for (let a = 0; a < week.length - 2; a++) {
        let length2 = order.length - 1;
        let last = order[length2];
        let newTeam = currentWeek[last];
        order.push(newTeam);
        let length3 = order.length - 1;
        let last2 = order[length3];
        modalBody.innerHTML +=
          '<br> <span class="badge text-bg-secondary">' + order[length3];
        if (checkInit(order[last], order[last2])) {
          modalBody.innerHTML +=
            '</span> <br> <i style="color: red" class="bi bi-caret-down-fill"></i>';
          errors++;
        } else {
          modalBody.innerHTML +=
            '</span> <br> <i class="bi bi-caret-down-fill"></i>';
        }
      }

      let replacement = document.getElementById("rep");
      if (errors > 0) {
        replacement.innerHTML +=
          '<h3><span class="badge bg-warning"><i class="bi bi-exclamation-triangle"></i> There are ' +
          errors +
          ' teams with repeat targets <i class="bi bi-exclamation-triangle"></i></span></h3>';
      }
      modalBody.lastElementChild.remove();
      function checkInit(a, b) {
        //a = pers   b = target
        for (let c = 0; c + 1 < history.length; c++) {
          let past = eval("history[c]." + a + ";");
          if (past == b) {
            return true;
          }
          return false;
        }
      }
    } else {
      modalBody.innerHTML +=
        "<div>looks like you havent had any weeks yet</div>";
    }
  }
  function saveTeams() {
    document.getElementById("randomBody");
    var classList = document.getElementsByClassName("teamBadge");
    var randomTeams = [];
    for (let a = 0; a < classList.length; a++) {
      randomTeams.push(classList[a].innerHTML);
    }

    if (typeof randomTeams === "undefined") {
      alert("there was no change");
    } else {
      newSave(randomTeams);
      saveHistory(randomTeams);
    }
  }
  const tooltipTriggerList = document.querySelectorAll(
    '[data-bs-toggle="tooltip"]'
  );
  const tooltipList = [...tooltipTriggerList].map(
    (tooltipTriggerEl) => new bootstrap.Tooltip(tooltipTriggerEl)
  );

  async function save(a) {
    var teams = await updateTeams;
    var currentTeam = teams[a].teamName;
    var teamArray = teams[a];
    var player1Var = document.getElementById(currentTeam + "-player1").value;
    var player2Var = document.getElementById(currentTeam + "-player2").value;
    var player3Var = document.getElementById(currentTeam + "-player3").value;
    var player4Var = document.getElementById(currentTeam + "-player4");
    var player4Var2 = document.getElementById(currentTeam + "-player4");
    var squadWipes = document.getElementById(currentTeam + "squad").value;  
    var targets = document.getElementById(currentTeam.replace(/\s/g, "") + "Select").value;
    var teamStat = document.getElementById('teamStatus' + currentTeam.replace(/\s/g, "")).checked;
    var teamSafe = document.getElementById('teamSafe' + currentTeam.replace(/\s/g, "")).checked;
    if (player4Var.value) {
      var player4Var = document.getElementById(currentTeam + "-player4").value;
    } else {
      var player4Var = null;
    }

    var newPassword = document.getElementById(currentTeam + "Password").value;

    var totalChecked = 0;
    var player1Checked = document.getElementById(currentTeam + "Box1").checked;
    if (player1Checked) {
      totalChecked++;
    }
    var player2Checked = document.getElementById(currentTeam + "Box2").checked;
    if (player2Checked) {
      totalChecked++;
    }
    var player3Checked = document.getElementById(currentTeam + "Box3").checked;
    if (player3Checked) {
      totalChecked++;
    }
    if (player4Var2.value) {
      var player4Checked = document.getElementById(
        currentTeam + "Box4"
      ).checked;
      if (player4Checked) {
        totalChecked++;
      }
    } else {
      var player4Checked = null;
    }
    status = true;
    if (totalChecked == 0) {
      var status = false;
    }

    if ((player1Var, player2Var, player3Var && !isNaN(squadWipes))) {
      adminEditCheck(
        a,
        player1Checked,
        player2Checked,
        player3Checked,
        player4Checked,
        player1Var,
        player2Var,
        player3Var,
        player4Var,
        newPassword
      );

      adminEdit(
        a,
        player1Var,
        player2Var,
        player3Var,
        player4Var,
        targets,
        newPassword,
        teamStat,
        teamSafe,
        squadWipes
      );
    } else {
      alert("Must have all values filled (excpet player 4) and Squad Wipes must be a valid number");
    }
  }

  function clearAddForm() {
    var name = (document.getElementById("addName").value = "");
    var checked = (document.getElementById("addCheck").checked = true);
    var password = (document.getElementById("addPassword").value = "");
    var player1 = (document.getElementById("addPlayer1").value = "");
    var checked1 = (document.getElementById("newP1").checked = true);
    var player2 = (document.getElementById("addPlayer2").value = "");
    var checked2 = (document.getElementById("newP2").checked = true);
    var player3 = (document.getElementById("addPlayer3").value = "");
    var checked3 = (document.getElementById("newP3").checked = true);
    var testVal = (document.getElementById("addPlayer4").value = "");
    var checked4 = (document.getElementById("newP4").checked = true);
    var target = (document.getElementById("addSelect").value = "defaultValue");
  }

  initNotifications();
  async function initNotifications() {
    var teams = await updateTeams;
    for (let a = 0; a < teams.length; a++) {
      if (teams[a].adminRead == false) {
        document.getElementById('notification').style.display = 'inline-block'
      }
    }
  }
</script>

<style>
  .navbar {
    background-color: #2e4b73 !important;
    min-height: 9vh;
  }
  .navbar-toggler {
    border-color: white;
    border-width: 1px;
  }

  .select2-container {
    min-width: 10rem !important;
  }

  .loginButton {
    position: absolute;
    right: 1vw;
  }

  @media (max-width: 991px) {
    #right {
      display: none;
    }

    #left {
      display: none;
    }

    #logout {
      margin-top: 15px;
    }
    .teamButton {
      height: 5.3rem;
      width: 6rem;
    }
  }

  #container {
    min-height: 90vh;
  }

  #row {
    min-height: 90vh;
    align-items: normal !important;
  }

  #left {
    background-color: #8b8b8b;
    min-height: 91vh;
  }

  #right {
    background-color: #8b8b8b;
    min-height: 91vh;
  }
  .teamButton {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  @media (min-width: 991px) {
  .teamButton {
    margin-left: 1rem;
    margin-right: 1rem;
    height: 5rem;
    width: 7rem;
  }
}
  #rep {
    margin-top: 1rem;
    margin-bottom: -1rem;
  }
  .toast-container {
    right: 2vh;
    position: fixed;
    top: 11vh;
  }
  .notification {
    display: inline-block;
  }
  .statBut {
    margin-left: 1rem;
  }
</style>
