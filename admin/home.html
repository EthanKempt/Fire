<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin: Assassins</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
      crossorigin="anonymous"
    ></script>
    <script src="/src/site.js"></script>
    <script src="/dist/bundleTeams.js"></script>
    <script src="/dist/bundleAdmin.js"></script>
  </head>
  <body>
    <nav
      class="navbar navbar-dark sticky-top navbar-expand-lg bg-body-tertiary"
    >
      <div class="container-fluid">
        <a class="navbar-brand">Higley</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-link active" href="home.html">Home</a>
            <a class="nav-link" href="teams.html">Teams</a>
            <a class="nav-link" href="players.html">Players</a>
            <a class="nav-link" href="messages.html"
              >Messages
              <span
                id="notification"
                class="top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle notification"
                style="display:none"
              >
                <span class="visually-hidden">New alerts</span>
              </span></a
            >
            <a class="nav-link" href="rules.html">Rules</a>
            <button
              type="button"
              id="logout"
              onclick="logout()"
              class="btn btn-primary me-auto loginButton"
              data-bs-toggle="modal"
              data-bs-target="#loginModal"
            >
              Log Out
            </button>
          </div>
        </div>
      </div>
    </nav>

    <div class="container column text-center">
      <div class="row align-items-middle">
        <div class="col col-2 left-side"></div>
        <div class="col-sm-8">
          <div class="input-group mb-3" id="pot">
            <span class="input-group-text">Current Pot Value</span>
            <input
              type="text"
              id="potVal"
              class="form-control"
              aria-label="Sizing example input"
              aria-describedby="inputGroup-sizing-default"
            />
            <button
              class="btn btn-outline-primary"
              type="button"
              onclick="updatePot()"
              id="button-addon2"
            >
              Update
            </button>
          </div>
          <div class="input-group mb-3" id="startDate">
            <span class="input-group-text" id="inputGroup-sizing-default"
              >Date Started</span
            >
            <button
              class="btn btn-outline-secondary dropdown-toggle"
              id="month"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              Month
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a class="dropdown-item" onclick="updateMonth('January')"
                  >January</a
                >
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('Febuary')"
                  >Febuary</a
                >
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('March')"
                  >March</a
                >
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('April')"
                  >April</a
                >
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('May')">May</a>
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('June')">June</a>
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('July')">July</a>
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('August')"
                  >August</a
                >
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('September')"
                  >September</a
                >
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('October')"
                  >October</a
                >
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('November')"
                  >November</a
                >
              </li>
              <li>
                <a class="dropdown-item" onclick="updateMonth('December')"
                  >December</a
                >
              </li>
            </ul>
            <input
              type="text"
              class="form-control text-center date"
              id="day"
              placeholder="Day"
              aria-label="Server"
            />
            <input
              type="text"
              class="form-control text-center date"
              id="year"
              placeholder="Year"
              aria-label="Server"
            />
            <input
              type="text"
              class="form-control text-center date"
              id="hour"
              placeholder="Hr"
              aria-label="Server"
            />
            <input
              type="text"
              class="form-control text-center date"
              id="minute"
              placeholder="Min"
              aria-label="Server"
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              onclick="changeM()"
              id="M"
            >
              AM
            </button>
            <button
              class="btn btn-outline-primary"
              onclick="updateDate()"
              type="button"
              id="updateDate"
            >
              Update
            </button>
            <div id="underTime" class="form-text">
              Your password must be 8-20 characters long, contain letters and
              numbers, and must not contain spaces, special characters, or
              emoji.
            </div>
          </div>

          <div aria-live="polite" aria-atomic="true" class="position-relative">
            <!-- Position it: -->
            <!-- - `.toast-container` for spacing between toasts -->
            <!-- - `top-0` & `end-0` to position the toasts in the upper right corner -->
            <!-- - `.p-3` to prevent the toasts from sticking to the edge of the container  -->
            <div class="toast-container">
              <!-- Then put toasts within -->
              <div
                class="toast align-items-center text-bg-success border-0"
                role="alert"
                aria-live="assertive"
                aria-atomic="true"
                id="liveToast"
              >
                <div class="d-flex">
                  <div class="toast-body" id="toastBody"></div>
                  <button
                    type="button"
                    class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"
                    aria-label="Close"
                  ></button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col col-2 right-side"></div>
      </div>
    </div>
  </body>
</html>

<script>
  window.makeToast = function (content) {
    const toastLiveExample = document.getElementById("liveToast");
    const toastBootstrap =
      bootstrap.Toast.getOrCreateInstance(toastLiveExample);
    toastBootstrap.show();
    var body = (document.getElementById("toastBody").innerHTML = content);
  };

  initPot();
  async function initPot() {
    var admin = await updateAdmin;
    let pot = document.getElementById("potVal");
    pot.value = admin[0].pot;
  }

  document.getElementById("M").innerHTML = "AM";

  function updatePot() {
    var number = document.getElementById("potVal").value;
    var numb = Number(number);
    if (Number.isInteger(numb) && number.length > 0 && numb) {
      savePot(numb);
    } else {
      alert("doesnt look like youve put in a valid number");
    }
  }
  function updateDate() {
    let day = document.getElementById("day").value;
    let month = document.getElementById("month").innerHTML;
    let year = document.getElementById("year").value;
    let hour = document.getElementById("hour").value;
    let minute = document.getElementById("minute").value;
    let after = document.getElementById("M").innerHTML;
    if (after == "PM") {
      let hr = Number(hour);
      hour = hr + 12;
    }
    new Date("September 30, 2023 12:45");
    let date = new Date(
      month + " " + day + ", " + year + " " + hour + ":" + minute
    );
    saveDate(date);
  }
  function updateMonth(a) {
    let month = document.getElementById("month");
    month.innerHTML = a;
  }

  function changeM() {
    let box = document.getElementById("M");
    if (box.innerHTML == "AM") {
      box.innerHTML = "PM";
    } else {
      box.innerHTML = "AM";
    }
  }

  initDate();
  async function initDate() {
    var admin = await updateAdmin;
    let months = [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December",
    ];
    let startDate = new Date(admin[0].startDate.seconds * 1000);
    var hoursM = startDate.getHours();
    var m = "AM";
    if (hoursM > 12) {
      hoursM = hoursM - 12;
      m = "PM";
    }
    let day = (document.getElementById("day").value = startDate.getDate());
    let month = (document.getElementById("month").innerHTML =
      months[startDate.getMonth()]);
    let year = (document.getElementById("year").value =
      startDate.getFullYear());
    let hour = (document.getElementById("hour").value = hoursM);
    let minute = (document.getElementById("minute").value =
      startDate.getMinutes());
    let after = (document.getElementById("M").innerHTML = m);
  }

  refreshTime();
  async function refreshTime() {
    var admin = await updateAdmin;
    let startMilli = admin[0].startDate.seconds * 1000;

    const current = new Date();
    let milli = current.getTime();

    let timeSince = milli - startMilli;

    let weeksLong = timeSince / 604800000;
    let weeks = Math.floor(weeksLong);
    let daysLong = (weeksLong - weeks) * 7;
    let days = Math.floor(daysLong);
    let hoursLong = (daysLong - days) * 24;
    let hours = Math.floor(hoursLong);
    let minutesLong = (hoursLong - hours) * 60;
    let minutes = Math.floor(minutesLong);
    let secondsLong = (minutesLong - minutes) * 60;
    let seconds = Math.floor(secondsLong);

    if (String(seconds).length == 1) {
      var zero = "0";
    } else {
      var zero = "";
    }

    document.getElementById("underTime").innerHTML =
      weeks +
      "w " +
      days +
      "d " +
      hours +
      ":" +
      minutes +
      ":" +
      zero +
      seconds +
      "";
  }
  setInterval(refreshTime, 1000);

  initNotifications();
  async function initNotifications() {
    var teams = await updateTeams;
    for (let a = 0; a < teams.length; a++) {
      if (teams[a].adminRead == false) {
        document.getElementById('notification').style.display = 'inline-block'
      }
    }
  }
</script>

<style>
  .navbar {
    background-color: #2e4b73 !important;
    min-height: 9vh;
  }
  .navbar-toggler {
    border-color: white;
    border-width: 1px;
  }

  .container {
    margin-left: 0px;
    margin-right: 0px;
  }
  .display-1 {
    font-weight: 500;
  }
  .h5 {
    margin-top: 15px;
    margin-bottom: 0px;
  }
  .left-side {
    background-color: #8b8b8b;
    height: 100vh;
  }
  .right-side {
    background-color: #8b8b8b;
    height: 100vh;
  }
  .row {
    width: 98.79vw;
  }
  .loginButton {
    position: absolute;
    right: 1vw;
  }
  @media (max-width: 991px) {
    .right-side {
      display: none;
    }
    .left-side {
      display: none;
    }
    #logout {
      margin-top: 15px;
    }
    .date {
      width: 4rem !important
    }
  }
  #pot {
    margin-top: 1rem;
  }
  #updateDate {
    border-top-right-radius: 5px;
    border-bottom-right-radius: 5px;
  }
  #underTime {
    margin-right: 40rem;
  }
  .toast-container {
    right: 2vh;
    position: fixed;
    top: 11vh;
  }
  .notification {
    display: inline-block;
  }
</style>
